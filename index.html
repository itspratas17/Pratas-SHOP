<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pratas Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/jpeg" href="favicon.jpg">
    <script src="https://www.paypal.com/sdk/js?client-id=Af2JphH-9dx1TEPujfpjDFUSQzIEqOSgm1uAJ7tldWqcX0hSWANU4g2BbT2HTPJN5_Y4t-Q7Czu3fKsl&currency=EUR"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; }
        header { background: #1a1a1a; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ff0844; position: sticky; top: 0; z-index: 1000; }
        .logo { display: flex; align-items: center; gap: 10px; font-size: 24px; font-weight: bold; color: #ff0844; cursor: pointer; }
        .logo img { width: 40px; height: 40px; border-radius: 8px; }
        .cart-btn { background: #ff0844; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; text-align: center; }
        
        .menu-categorias { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card-categoria { position: relative; height: 180px; border-radius: 12px; overflow: hidden; cursor: pointer; border: 2px solid #333; }
        .card-categoria img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; transition: 0.3s; }
        .card-categoria:hover img { opacity: 0.7; transform: scale(1.05); }
        .card-categoria h2 { position: absolute; bottom: 15px; left: 15px; font-size: 22px; }

        #areaItens { display: none; }
        .lista-subitens { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .item-clicavel { background: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; border: 1px solid #333; text-align: left; }
        .item-img { width: 100%; height: 140px; object-fit: cover; border-bottom: 2px solid #ff0844; }
        .item-info { padding: 12px; }

        #adminPanel { display: none; background: #111; padding: 30px; border-radius: 15px; border: 2px solid #ff0844; margin: 20px auto; max-width: 700px; text-align: left; box-shadow: 0 0 30px rgba(255, 8, 68, 0.2); }
        .admin-input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn-admin-save { background: #ff0844; color: white; padding: 14px; border: none; width: 100%; cursor: pointer; font-weight: bold; border-radius: 8px; margin-top: 10px; }
        
        .gestao-lista { margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; max-height: 300px; overflow-y: auto; }
        .gestao-item { display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; padding: 10px; border-radius: 5px; margin-bottom: 8px; border: 1px solid #222; }
        .gestao-btns button { padding: 5px 10px; cursor: pointer; border-radius: 4px; border: none; font-size: 12px; font-weight: bold; margin-left: 5px; }
        .btn-edit { background: #ffb347; color: #000; }
        .btn-del { background: #ff0844; color: #fff; }

        .upload-container { border: 1px dashed #444; border-radius: 12px; padding: 20px; text-align: center; background: #151515; margin: 15px 0; }
        .btn-enviar-img { background: linear-gradient(90deg, #ffb347 0%, #ff4b2b 100%); color: white; padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; display: inline-flex; align-items: center; gap: 10px; font-size: 14px; }
        
        .sidebar-cart { position: fixed; right: -100%; top: 0; width: 320px; height: 100vh; background: #1a1a1a; border-left: 2px solid #ff0844; z-index: 2000; transition: 0.4s; padding: 20px; display: flex; flex-direction: column; }
        .sidebar-cart.active { right: 0; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 450px; width: 90%; text-align: center; border: 1px solid #ff0844; }
        
        .animar { animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div onclick="voltarAoMenu()" class="logo">
            <img src="favicon.jpg" alt="Logo">
            <span>Pratas Shop</span>
        </div>
        <button class="cart-btn" onclick="toggleCart()">Cart (<span id="cart-count">0</span>)</button>
    </header>

    <div class="container">
        <div id="menuPrincipal" class="animar">
            <h1>PRATAS <span style="color:#ff0844">SHOP</span></h1>
            <div class="menu-categorias">
                <div class="card-categoria" onclick="abrirCategoria('streaming')">
                    <img src="https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=500" alt="Streaming">
                    <h2>STREAMING</h2>
                </div>
                <div class="card-categoria" onclick="abrirCategoria('games')">
                    <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=500" alt="Games">
                    <h2>GAMES</h2>
                </div>
                <div class="card-categoria" onclick="abrirCategoria('social')">
                    <img src="https://images.unsplash.com/photo-1614102073832-030967418971?w=500" alt="Social">
                    <h2>SOCIAL</h2>
                </div>
            </div>
        </div>

        <div id="areaItens" class="animar">
            <button onclick="voltarAoMenu()" style="background:transparent; color:#ff0844; border:1px solid #ff0844; padding:8px 15px; border-radius:5px; cursor:pointer; margin-bottom:20px;">← Back</button>
            <h2 id="tituloCategoria" style="color:#ff0844; text-transform: uppercase;"></h2>
            <div id="listaItens" class="lista-subitens"></div>
        </div>

        <div id="adminPanel" class="animar">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="adminTitle" style="color:#ff0844;">New Product</h2>
                <button onclick="fecharAdmin()" style="background:transparent; color:#ff0844; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            
            <input type="hidden" id="editId">
            
            <input type="text" id="admNome" class="admin-input" placeholder="Product Name">
            <input type="text" id="admDesc" class="admin-input" placeholder="Description (Optional)">
            <input type="number" id="admPreco" class="admin-input" placeholder="Price (€)" step="0.01">
            <select id="admCat" class="admin-input">
                <option value="streaming">Streaming</option>
                <option value="games">Games</option>
                <option value="social">Social</option>
            </select>
            
            <div class="upload-container">
                <input type="file" id="admImgFile" hidden accept="image/*" onchange="handleFile(this.files[0])">
                <button class="btn-enviar-img" onclick="document.getElementById('admImgFile').click()">Upload Image</button>
                <input type="text" id="admImgURL" class="admin-input" placeholder="Or paste image URL" oninput="handleURL(this.value)">
                <div id="mini-preview" style="display:none; margin-top:10px;">
                    <p style="font-size: 10px; color: #888; margin-bottom: 5px;">Preview:</p>
                    <img id="imgPre" style="width:60px; height:60px; object-fit:cover; border-radius:5px; border: 1px solid #ff0844;">
                </div>
            </div>
            
            <button class="btn-admin-save" id="btnSalvar" onclick="salvarProduto()">ADD PRODUCT</button>
            <button id="btnCancelEdit" onclick="resetForm()" style="display:none; background:transparent; color:#888; border:none; width:100%; margin-top:10px; cursor:pointer;">Cancel Editing</button>

            <div class="gestao-lista" id="listaGestao"></div>
        </div>
    </div>

    <div id="sidebarCart" class="sidebar-cart">
        <h2 style="color: #ff0844; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">Your Cart</h2>
        <div id="cart-items" style="flex-grow:1; overflow-y: auto;"></div>
        <div style="border-top:1px solid #333; padding-top:15px; margin-top: 10px;">
            <p style="font-size: 18px; margin-bottom: 15px;">Total: <span id="cart-total" style="font-weight: bold; color: #ff0844;">€0.00</span></p>
            <label style="font-size: 11px; color: #888; display: block; margin-bottom: 5px;">DISCORD USERNAME:</label>
            <input type="text" id="discordUser" placeholder="Ex: user#0000" style="width: 100%; padding: 10px; background: #000; border: 1px solid #333; color: white; border-radius: 5px; margin-bottom: 15px;">
            <div id="paypal-button-container"></div>
            <button onclick="toggleCart()" style="width:100%; background:transparent; color:#666; border:none; padding:10px; margin-top:5px; cursor:pointer; font-size: 12px;">Close Cart</button>
        </div>
    </div>

    <div id="modalDetalhe" class="modal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:24px;" onclick="fecharModal()">&times;</span>
            <div id="modalIcone"></div>
            <h2 id="modalNome" style="margin-top:10px;"></h2>
            <p id="modalDesc" style="color:#888; margin:10px 0;"></p>
            <h1 id="modalPreco" style="color:#ff0844;"></h1>
            <button class="btn-admin-save" onclick="adicionarAoCarrinho()">ADD TO CART</button>
        </div>
    </div>

    <script>
        let produtos = JSON.parse(localStorage.getItem('pratas_stock')) || [];
        let carrinho = [];
        let imagemFinal = null;
        let produtoAtual = null;

        // --- ADMIN SYSTEM ---
        let seq = "";
        window.addEventListener("keydown", (e) => {
            seq += e.key.toUpperCase();
            if (seq.includes("DAS")) {
                seq = "";
                if(prompt("Password:") === "AdminPratasShop") {
                    document.getElementById('adminPanel').style.display = 'block';
                    atualizarListaGestao();
                }
            }
        });

        function fecharAdmin() { document.getElementById('adminPanel').style.display = 'none'; resetForm(); }

        function handleURL(url) {
            if(url.length > 5) {
                imagemFinal = url;
                document.getElementById('mini-preview').style.display = 'block';
                document.getElementById('imgPre').src = url;
            }
        }

        function handleFile(file) {
            if(!file) return;
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => {
                imagemFinal = e.target.result;
                document.getElementById('mini-preview').style.display = 'block';
                document.getElementById('imgPre').src = imagemFinal;
            };
        }

        // FUNÇÃO PARA CARREGAR DADOS NO FORMULÁRIO PARA EDITAR
        function editarProduto(id) {
            const p = produtos.find(item => item.id == id);
            if(!p) return;

            document.getElementById('adminTitle').innerText = "Editing: " + p.nome;
            document.getElementById('editId').value = p.id;
            document.getElementById('admNome').value = p.nome;
            document.getElementById('admPreco').value = p.preco;
            document.getElementById('admDesc').value = p.desc;
            document.getElementById('admCat').value = p.categoria;
            
            imagemFinal = p.img;
            document.getElementById('mini-preview').style.display = 'block';
            document.getElementById('imgPre').src = p.img;
            
            document.getElementById('btnSalvar').innerText = "SAVE CHANGES";
            document.getElementById('btnCancelEdit').style.display = "block";
            
            // Scroll para o topo do painel
            document.getElementById('adminPanel').scrollTop = 0;
        }

        function salvarProduto() {
            const id = document.getElementById('editId').value;
            const nome = document.getElementById('admNome').value;
            const preco = parseFloat(document.getElementById('admPreco').value);
            const desc = document.getElementById('admDesc').value || "";
            const cat = document.getElementById('admCat').value;

            if(!nome || isNaN(preco) || !imagemFinal) return alert("Please fill Name, Price and Image!");

            if(id) {
                // MODO EDIÇÃO
                const index = produtos.findIndex(p => p.id == id);
                produtos[index] = { id: parseInt(id), nome, preco, desc, img: imagemFinal, categoria: cat };
                alert("Product updated!");
            } else {
                // MODO NOVO
                produtos.push({ id: Date.now(), nome, preco, desc, img: imagemFinal, categoria: cat });
                alert("Product added!");
            }

            localStorage.setItem('pratas_stock', JSON.stringify(produtos));
            resetForm();
            atualizarListaGestao();
            // Se estivermos numa categoria, atualiza a vista
            if(document.getElementById('areaItens').style.display === 'block') {
                abrirCategoria(cat);
            }
        }

        function apagarProduto(id) {
            if(confirm("Delete this product permanently?")) {
                produtos = produtos.filter(p => p.id != id);
                localStorage.setItem('pratas_stock', JSON.stringify(produtos));
                atualizarListaGestao();
            }
        }

        function atualizarListaGestao() {
            const container = document.getElementById('listaGestao');
            container.innerHTML = produtos.map(p => `
                <div class="gestao-item">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <img src="${p.img}" style="width:30px; height:30px; object-fit:cover; border-radius:4px;">
                        <span>${p.nome} (€${p.preco.toFixed(2)})</span>
                    </div>
                    <div class="gestao-btns">
                        <button class="btn-edit" onclick="editarProduto(${p.id})">Edit</button>
                        <button class="btn-del" onclick="apagarProduto(${p.id})">X</button>
                    </div>
                </div>
            `).join('');
        }

        function resetForm() {
            document.getElementById('editId').value = "";
            document.getElementById('admNome').value = "";
            document.getElementById('admPreco').value = "";
            document.getElementById('admDesc').value = "";
            document.getElementById('admImgURL').value = "";
            document.getElementById('admImgFile').value = "";
            document.getElementById('mini-preview').style.display = 'none';
            document.getElementById('adminTitle').innerText = "New Product";
            document.getElementById('btnSalvar').innerText = "ADD PRODUCT";
            document.getElementById('btnCancelEdit').style.display = "none";
            imagemFinal = null;
        }

        // --- NAVIGATION & STORE LOGIC ---
        function abrirCategoria(cat) {
            document.getElementById('menuPrincipal').style.display = 'none';
            document.getElementById('areaItens').style.display = 'block';
            document.getElementById('tituloCategoria').innerText = cat;
            const filtrados = produtos.filter(p => p.categoria === cat);
            document.getElementById('listaItens').innerHTML = filtrados.map(p => `
                <div class="item-clicavel" onclick="abrirDetalhe(${p.id})">
                    <img src="${p.img}" class="item-img">
                    <div class="item-info"><h3>${p.nome}</h3><span>€${p.preco.toFixed(2)}</span></div>
                </div>`).join('') || "<p style='grid-column: 1/-1;'>No products found in this category.</p>";
        }

        function voltarAoMenu() { document.getElementById('menuPrincipal').style.display = 'block'; document.getElementById('areaItens').style.display = 'none'; }

        function abrirDetalhe(id) {
            const p = produtos.find(item => item.id == id);
            produtoAtual = p;
            document.getElementById('modalNome').innerText = p.nome;
            document.getElementById('modalDesc').innerText = p.desc || "No description available.";
            document.getElementById('modalPreco').innerText = `€${p.preco.toFixed(2)}`;
            document.getElementById('modalIcone').innerHTML = `<img src="${p.img}" style="width:100%; height:180px; object-fit:cover; border-radius:10px; border: 1px solid #333;">`;
            document.getElementById('modalDetalhe').style.display = 'flex';
        }

        function fecharModal() { document.getElementById('modalDetalhe').style.display = 'none'; }

        function toggleCart() { 
            document.getElementById('sidebarCart').classList.toggle('active'); 
            if(document.getElementById('sidebarCart').classList.contains('active')) renderPaypalButtons();
        }

        function adicionarAoCarrinho() {
            carrinho.push(produtoAtual);
            atualizarCarrinhoUI();
            fecharModal();
            toggleCart();
        }

        function atualizarCarrinhoUI() {
            document.getElementById('cart-count').innerText = carrinho.length;
            let total = 0;
            document.getElementById('cart-items').innerHTML = carrinho.map((i, index) => {
                total += i.preco;
                return `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; font-size: 14px; background:#000; padding:8px; border-radius:5px;">
                            <div>
                                <p style="font-weight:bold;">${i.nome}</p>
                                <p style="color:#ff0844;">€${i.preco.toFixed(2)}</p>
                            </div>
                            <button onclick="removerDoCarrinho(${index})" style="background:none; border:none; color:#555; cursor:pointer;">&times;</button>
                        </div>`;
            }).join('');
            document.getElementById('cart-total').innerText = `€${total.toFixed(2)}`;
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinhoUI();
        }

        function renderPaypalButtons() {
            document.getElementById('paypal-button-container').innerHTML = '';
            if(carrinho.length === 0) return;

            paypal.Buttons({
                createOrder: function(data, actions) {
                    const discord = document.getElementById('discordUser').value;
                    if (!discord) { alert("Please enter your Discord!"); return actions.reject(); }
                    let val = document.getElementById('cart-total').innerText.replace('€', '');
                    return actions.order.create({
                        purchase_units: [{ description: "Pratas Shop - Discord: " + discord, amount: { value: val } }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        alert('Order confirmed! We will contact you on Discord.');
                        carrinho = []; atualizarCarrinhoUI(); toggleCart();
                    });
                }
            }).render('#paypal-button-container');
        }
    </script>
</body>
</html>
